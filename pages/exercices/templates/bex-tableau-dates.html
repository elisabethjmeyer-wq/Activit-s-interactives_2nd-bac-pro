<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BEX n¬∞1 | Espace cours</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        :root {
            --primary: #6366f1;
            --primary-light: #818cf8;
            --primary-dark: #4f46e5;
            --primary-bg: #eef2ff;
            --accent-yellow: #f59e0b;
            --accent-green: #10b981;
            --accent-green-light: #d1fae5;
            --accent-red: #ef4444;
            --accent-red-light: #fee2e2;
            --gray-50: #f9fafb;
            --gray-100: #f3f4f6;
            --gray-200: #e5e7eb;
            --gray-400: #9ca3af;
            --gray-500: #6b7280;
            --gray-600: #4b5563;
            --gray-700: #374151;
            --gray-800: #1f2937;
            --gray-900: #111827;
            --sidebar-width: 280px;
            --header-height: 64px;
            --radius: 12px;
            --radius-lg: 16px;
            --shadow: 0 1px 3px rgba(0,0,0,0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0,0,0,0.1);
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        /* ============================================
           HEADER
           ============================================ */
        .header {
            background: white;
            border-bottom: 1px solid var(--gray-200);
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: var(--header-height);
            z-index: 100;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }

        .header-inner {
            height: 100%;
            padding: 0 20px;
            display: flex;
            align-items: center;
            gap: 16px;
        }

        /* Menu Toggle - Style hamburger */
        .menu-toggle {
            width: 42px;
            height: 42px;
            background: var(--primary-bg);
            border: none;
            border-radius: 10px;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 5px;
            transition: all 0.3s;
        }

        .menu-toggle span {
            display: block;
            width: 20px;
            height: 2px;
            background: var(--primary);
            border-radius: 2px;
            transition: all 0.3s;
        }

        .menu-toggle:hover {
            background: var(--primary);
        }

        .menu-toggle:hover span {
            background: white;
        }

        .menu-toggle.active {
            background: var(--primary);
        }

        .menu-toggle.active span {
            background: white;
        }

        .menu-toggle.active span:nth-child(1) {
            transform: rotate(45deg) translate(5px, 5px);
        }

        .menu-toggle.active span:nth-child(2) {
            opacity: 0;
        }

        .menu-toggle.active span:nth-child(3) {
            transform: rotate(-45deg) translate(5px, -5px);
        }

        /* Logo */
        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            font-weight: 700;
            font-size: 18px;
            color: var(--gray-900);
            text-decoration: none;
        }

        .logo-icon {
            width: 38px;
            height: 38px;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 18px;
        }

        .logo-subtitle {
            color: var(--gray-500);
            font-weight: 400;
            font-size: 14px;
        }

        /* ============================================
           SIDEBAR
           ============================================ */
        .sidebar {
            position: fixed;
            top: var(--header-height);
            left: 0;
            width: var(--sidebar-width);
            height: calc(100vh - var(--header-height));
            background: white;
            border-right: 1px solid var(--gray-200);
            overflow-y: auto;
            z-index: 90;
            transform: translateX(-100%);
            transition: transform 0.3s ease;
            padding: 16px 12px;
        }

        .sidebar.open {
            transform: translateX(0);
        }

        /* Sidebar sections */
        .sidebar-section {
            margin-bottom: 8px;
        }

        .sidebar-section-title {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px 16px 8px;
            font-size: 11px;
            font-weight: 700;
            color: var(--gray-500);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .sidebar-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 10px 16px;
            border-radius: 10px;
            color: var(--gray-700);
            text-decoration: none;
            font-weight: 500;
            font-size: 14px;
            transition: all 0.2s;
            margin-bottom: 2px;
        }

        .sidebar-item:hover {
            background: var(--gray-100);
            color: var(--gray-900);
        }

        .sidebar-item.active {
            background: var(--primary-bg);
            color: var(--primary);
        }

        .sidebar-item.disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .sidebar-item.disabled:hover {
            background: transparent;
        }

        .item-icon {
            font-size: 18px;
            width: 24px;
            text-align: center;
            flex-shrink: 0;
        }

        .item-text {
            display: flex;
            flex-direction: column;
            line-height: 1.3;
        }

        .item-sub {
            font-size: 11px;
            color: var(--gray-400);
            font-weight: 400;
        }

        /* ============================================
           OVERLAY
           ============================================ */
        .overlay {
            position: fixed;
            top: var(--header-height);
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.3);
            z-index: 80;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
        }

        .overlay.visible {
            opacity: 1;
            visibility: visible;
        }

        /* ============================================
           MAIN CONTENT
           ============================================ */
        .main {
            margin-top: var(--header-height);
            padding: 24px;
            min-height: calc(100vh - var(--header-height));
            transition: margin-left 0.3s ease;
        }

        .main-inner {
            max-width: 900px;
            margin: 0 auto;
        }

        /* Desktop: sidebar always visible */
        @media (min-width: 1024px) {
            .sidebar {
                transform: translateX(0);
            }
            .main {
                margin-left: var(--sidebar-width);
            }
            .overlay {
                display: none;
            }
        }

        /* ============================================
           BREADCRUMB
           ============================================ */
        .breadcrumb {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 20px;
            font-size: 14px;
            flex-wrap: wrap;
        }

        .breadcrumb a {
            color: rgba(255,255,255,0.8);
            text-decoration: none;
        }

        .breadcrumb a:hover {
            color: white;
        }

        .breadcrumb .separator {
            color: rgba(255,255,255,0.5);
        }

        .breadcrumb .current {
            color: white;
            font-weight: 500;
        }

        /* ============================================
           PAGE HEADER
           ============================================ */
        .page-header {
            background: white;
            border-radius: var(--radius-lg);
            padding: 24px;
            margin-bottom: 20px;
            box-shadow: var(--shadow-lg);
        }

        .page-header h1 {
            font-size: 24px;
            color: var(--gray-800);
            margin-bottom: 4px;
        }

        .page-subtitle {
            color: var(--gray-500);
            margin: 0;
        }

        /* ============================================
           TIMER
           ============================================ */
        .timer-box {
            background: linear-gradient(135deg, var(--accent-yellow), #fbbf24);
            color: white;
            border-radius: var(--radius);
            padding: 16px;
            margin-bottom: 20px;
            text-align: center;
            font-size: 22px;
            font-weight: bold;
            box-shadow: 0 4px 12px rgba(245, 158, 11, 0.3);
        }

        .timer-box.warning {
            background: linear-gradient(135deg, var(--accent-red), #dc2626);
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); }
        }

        /* ============================================
           INSTRUCTIONS
           ============================================ */
        .instructions {
            background: white;
            border-radius: var(--radius);
            padding: 20px;
            margin-bottom: 20px;
            border-left: 4px solid var(--accent-yellow);
            box-shadow: var(--shadow);
        }

        .instructions strong {
            color: var(--accent-yellow);
        }

        .instructions p {
            color: var(--gray-600);
            margin-top: 8px;
            line-height: 1.6;
        }

        /* ============================================
           EXERCISE CARD
           ============================================ */
        .exercise-card {
            background: white;
            border-radius: var(--radius-lg);
            padding: 24px;
            box-shadow: var(--shadow-lg);
        }

        /* ============================================
           TABLE
           ============================================ */
        .table-container {
            overflow-x: auto;
            margin-bottom: 24px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 600px;
        }

        th {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            padding: 14px 12px;
            text-align: center;
            font-weight: 600;
            font-size: 14px;
        }

        th:first-child {
            border-radius: var(--radius) 0 0 0;
        }

        th:last-child {
            border-radius: 0 var(--radius) 0 0;
        }

        td {
            padding: 12px;
            border: 1px solid var(--gray-200);
            text-align: center;
        }

        td.date-cell {
            background: var(--gray-100);
            font-weight: 700;
            font-size: 18px;
            color: var(--primary);
            width: 100px;
        }

        input[type="text"] {
            width: 100%;
            padding: 10px;
            border: 2px solid var(--gray-200);
            border-radius: 8px;
            font-size: 14px;
            text-align: center;
            transition: all 0.3s;
            font-family: inherit;
        }

        input[type="text"]:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        input.correct {
            background: var(--accent-green-light);
            border-color: var(--accent-green);
            color: #065f46;
        }

        input.incorrect {
            background: var(--accent-red-light);
            border-color: var(--accent-red);
            color: #991b1b;
        }

        /* ============================================
           BUTTONS
           ============================================ */
        .buttons {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }

        button {
            flex: 1;
            min-width: 150px;
            padding: 14px;
            border: none;
            border-radius: var(--radius);
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: var(--shadow);
            font-family: inherit;
        }

        button:hover {
            transform: translateY(-2px);
        }

        .btn-verify {
            background: linear-gradient(135deg, var(--accent-green), #34d399);
            color: white;
        }

        .btn-solution {
            background: linear-gradient(135deg, #3b82f6, #60a5fa);
            color: white;
        }

        .btn-restart {
            background: linear-gradient(135deg, var(--gray-500), var(--gray-400));
            color: white;
        }

        /* ============================================
           RESULT
           ============================================ */
        .result {
            background: var(--accent-green-light);
            border: 2px solid var(--accent-green);
            border-radius: var(--radius);
            padding: 20px;
            margin-top: 20px;
            display: none;
        }

        .result.show {
            display: block;
        }

        .result h3 {
            color: #065f46;
            margin-bottom: 8px;
        }

        .result p {
            color: #047857;
        }

        /* ============================================
           LOADING & ERROR
           ============================================ */
        .loading {
            text-align: center;
            padding: 60px 20px;
            color: var(--gray-500);
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 4px solid var(--gray-200);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .error-message {
            background: var(--accent-red-light);
            border: 2px solid var(--accent-red);
            border-radius: var(--radius);
            padding: 20px;
            text-align: center;
            color: #991b1b;
        }

        .error-message a {
            color: #991b1b;
        }

        /* ============================================
           RESPONSIVE
           ============================================ */
        @media (max-width: 768px) {
            .main {
                padding: 16px;
            }

            .page-header h1 {
                font-size: 20px;
            }

            button {
                min-width: 100%;
            }

            th, td {
                padding: 8px 6px;
                font-size: 13px;
            }

            input[type="text"] {
                padding: 8px;
                font-size: 13px;
            }
        }
    </style>
</head>
<body>
    <!-- ============================================
         HEADER
         ============================================ -->
    <header class="header">
        <div class="header-inner">
            <button class="menu-toggle" id="menuToggle">
                <span></span>
                <span></span>
                <span></span>
            </button>
            <a href="/Activit-s-interactives_2nd-bac-pro/index.html" class="logo">
                <div class="logo-icon">üìö</div>
                <span>Espace cours</span>
                <span class="logo-subtitle">‚Ä¢ Mme Meyer</span>
            </a>
        </div>
    </header>

    <!-- ============================================
         SIDEBAR (charg√© dynamiquement)
         ============================================ -->
    <aside class="sidebar" id="sidebar">
        <!-- Contenu charg√© depuis components/sidebar.html -->
    </aside>

    <!-- ============================================
         OVERLAY
         ============================================ -->
    <div class="overlay" id="overlay"></div>

    <!-- ============================================
         MAIN CONTENT
         ============================================ -->
    <main class="main">
        <div class="main-inner">
            <!-- Breadcrumb -->
            <nav class="breadcrumb">
                <a href="/Activit-s-interactives_2nd-bac-pro/index.html">üè† Accueil</a>
                <span class="separator">‚Ä∫</span>
                <a href="/Activit-s-interactives_2nd-bac-pro/pages/entrainement-bex.html">Entra√Ænement BEX</a>
                <span class="separator">‚Ä∫</span>
                <span class="current" id="breadcrumbCurrent">BEX n¬∞1</span>
            </nav>

            <!-- Page header -->
            <div class="page-header">
                <h1 id="pageTitle">‚è∞ BEX n¬∞1</h1>
                <p class="page-subtitle">Se rep√©rer dans le temps</p>
            </div>

            <!-- Contenu de l'exercice -->
            <div id="content">
                <div class="loading">
                    <div class="loading-spinner"></div>
                    <p>Chargement de l'exercice...</p>
                </div>
            </div>
        </div>
    </main>

    <script>
        // ============================================
        // CONFIGURATION
        // ============================================
        const BASE_PATH = '/Activit-s-interactives_2nd-bac-pro';
        const SHEET_ID = '1voGqAzl_sgsa8ZKs_uDEFBanNUTBfkNz9Hq5wI1Vlzg';
        const SHEET_NAME = 'BEX1_DATA';

        // ============================================
        // VARIABLES GLOBALES
        // ============================================
        let exerciseData = null;
        let timeLeft = 600;
        let timerInterval = null;

        // ============================================
        // SIDEBAR
        // ============================================
        const sidebar = document.getElementById('sidebar');
        const menuToggle = document.getElementById('menuToggle');
        const overlay = document.getElementById('overlay');

        // Toggle sidebar
        menuToggle.addEventListener('click', () => {
            sidebar.classList.toggle('open');
            menuToggle.classList.toggle('active');
            overlay.classList.toggle('visible');
        });

        overlay.addEventListener('click', () => {
            sidebar.classList.remove('open');
            menuToggle.classList.remove('active');
            overlay.classList.remove('visible');
        });

        // Charger le sidebar partag√©
        async function loadSidebar() {
            try {
                const response = await fetch(`${BASE_PATH}/components/sidebar.html`);
                const html = await response.text();
                sidebar.innerHTML = html;
                
                // Marquer la page active (BEX)
                document.querySelectorAll('.sidebar-item').forEach(item => {
                    if (item.getAttribute('data-page') === 'entrainement-bex') {
                        item.classList.add('active');
                    }
                });
                
                // D√©sactiver les liens vides
                document.querySelectorAll('.sidebar-item.disabled').forEach(link => {
                    link.addEventListener('click', e => e.preventDefault());
                });
            } catch (error) {
                console.error('Erreur chargement sidebar:', error);
            }
        }

        // ============================================
        // R√âCUP√âRATION PARAM√àTRES URL
        // ============================================
        function getUrlParams() {
            const params = new URLSearchParams(window.location.search);
            return {
                exo: parseInt(params.get('exo')) || 1
            };
        }

        // ============================================
        // CHARGEMENT DONN√âES GOOGLE SHEETS
        // ============================================
        async function loadExerciseData(exoNum) {
            const url = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json&sheet=${encodeURIComponent(SHEET_NAME)}`;
            
            try {
                const response = await fetch(url);
                const text = await response.text();
                
                // Parser la r√©ponse Google Sheets
                const jsonStart = text.indexOf('{');
                const jsonEnd = text.lastIndexOf('}') + 1;
                const jsonText = text.substring(jsonStart, jsonEnd);
                const data = JSON.parse(jsonText);
                
                const rows = data.table.rows;
                
                // Trouver la ligne correspondant √† l'exercice
                for (let row of rows) {
                    const numExo = row.c[0]?.v;
                    if (numExo === exoNum) {
                        return {
                            numExo: numExo,
                            titre: row.c[1]?.v || `Exercice ${exoNum}`,
                            temps: row.c[2]?.v || 600,
                            dates: [
                                {
                                    date: row.c[3]?.v,
                                    siecle: (row.c[4]?.v || '').toString().split(',').map(s => s.trim().toLowerCase()),
                                    periode: (row.c[5]?.v || '').toString().split(',').map(s => s.trim().toLowerCase()),
                                    personnage: (row.c[6]?.v || '').toString().split(',').map(s => s.trim().toLowerCase())
                                },
                                {
                                    date: row.c[7]?.v,
                                    siecle: (row.c[8]?.v || '').toString().split(',').map(s => s.trim().toLowerCase()),
                                    periode: (row.c[9]?.v || '').toString().split(',').map(s => s.trim().toLowerCase()),
                                    personnage: (row.c[10]?.v || '').toString().split(',').map(s => s.trim().toLowerCase())
                                },
                                {
                                    date: row.c[11]?.v,
                                    siecle: (row.c[12]?.v || '').toString().split(',').map(s => s.trim().toLowerCase()),
                                    periode: (row.c[13]?.v || '').toString().split(',').map(s => s.trim().toLowerCase()),
                                    personnage: (row.c[14]?.v || '').toString().split(',').map(s => s.trim().toLowerCase())
                                },
                                {
                                    date: row.c[15]?.v,
                                    siecle: (row.c[16]?.v || '').toString().split(',').map(s => s.trim().toLowerCase()),
                                    periode: (row.c[17]?.v || '').toString().split(',').map(s => s.trim().toLowerCase()),
                                    personnage: (row.c[18]?.v || '').toString().split(',').map(s => s.trim().toLowerCase())
                                }
                            ]
                        };
                    }
                }
                
                throw new Error(`Exercice ${exoNum} non trouv√©`);
                
            } catch (error) {
                console.error('Erreur chargement donn√©es:', error);
                throw error;
            }
        }

        // ============================================
        // AFFICHAGE EXERCICE
        // ============================================
        function renderExercise(data) {
            // Mise √† jour du titre et breadcrumb
            document.getElementById('breadcrumbCurrent').textContent = `BEX n¬∞1 - ${data.titre}`;
            document.getElementById('pageTitle').textContent = `‚è∞ BEX n¬∞1 - ${data.titre}`;
            document.title = `BEX n¬∞1 - ${data.titre} | Espace cours`;
            
            timeLeft = data.temps || 600;

            const html = `
                <div class="timer-box" id="timer">
                    ‚è±Ô∏è Temps restant : ${formatTime(timeLeft)}
                </div>

                <div class="instructions">
                    <strong>üìã Consigne :</strong>
                    <p>Pour chaque date, trouve le si√®cle, la grande p√©riode historique et le personnage-rep√®re associ√© √† cette p√©riode.</p>
                </div>

                <div class="exercise-card">
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Si√®cle</th>
                                    <th>Grande p√©riode historique</th>
                                    <th>Personnage rep√®re</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${data.dates.map((d, i) => `
                                    <tr>
                                        <td class="date-cell">${d.date}</td>
                                        <td><input type="text" id="siecle-${i}" placeholder="Ex: 15e"></td>
                                        <td><input type="text" id="periode-${i}" placeholder="Ex: √âpoque moderne"></td>
                                        <td><input type="text" id="personnage-${i}" placeholder="Ex: Louis XIV"></td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>

                    <div class="buttons">
                        <button class="btn-verify" onclick="verifyAnswers()">‚úì V√©rifier mes r√©ponses</button>
                        <button class="btn-solution" onclick="showSolution()">üìñ Voir le corrig√©</button>
                        <button class="btn-restart" onclick="restart()">üîÑ Recommencer</button>
                    </div>

                    <div class="result" id="result">
                        <h3>üìä R√©sultat</h3>
                        <p id="resultMessage"></p>
                    </div>
                </div>
            `;

            document.getElementById('content').innerHTML = html;
            startTimer();
        }

        function renderError(message) {
            document.getElementById('content').innerHTML = `
                <div class="error-message">
                    <h3>‚ùå Erreur</h3>
                    <p>${message}</p>
                    <p style="margin-top: 12px;">
                        <a href="${BASE_PATH}/pages/entrainement-bex.html">
                            ‚Üê Retour √† la liste des exercices
                        </a>
                    </p>
                </div>
            `;
        }

        // ============================================
        // TIMER
        // ============================================
        function formatTime(seconds) {
            const m = Math.floor(seconds / 60);
            const s = seconds % 60;
            return `${m}:${s.toString().padStart(2, '0')}`;
        }

        function startTimer() {
            timerInterval = setInterval(() => {
                timeLeft--;
                const timerEl = document.getElementById('timer');
                if (timerEl) {
                    timerEl.textContent = `‚è±Ô∏è Temps restant : ${formatTime(timeLeft)}`;
                    
                    if (timeLeft <= 120) {
                        timerEl.classList.add('warning');
                    }
                    
                    if (timeLeft <= 0) {
                        clearInterval(timerInterval);
                        verifyAnswers();
                    }
                }
            }, 1000);
        }

        // ============================================
        // V√âRIFICATION DES R√âPONSES
        // ============================================
        function normalizeString(str) {
            return str.toLowerCase()
                      .trim()
                      .normalize("NFD")
                      .replace(/[\u0300-\u036f]/g, "")
                      .replace(/[^a-z0-9 ]/g, ' ')
                      .replace(/\s+/g, ' ')
                      .trim();
        }

        function checkAnswer(userAnswer, correctAnswers) {
            const normalized = normalizeString(userAnswer);
            return correctAnswers.some(answer => normalizeString(answer) === normalized);
        }

        function verifyAnswers() {
            clearInterval(timerInterval);
            
            let correctCount = 0;
            let totalFields = 0;

            exerciseData.dates.forEach((d, i) => {
                // V√©rifier si√®cle
                const siecleInput = document.getElementById(`siecle-${i}`);
                if (checkAnswer(siecleInput.value, d.siecle)) {
                    siecleInput.classList.add('correct');
                    siecleInput.classList.remove('incorrect');
                    correctCount++;
                } else {
                    siecleInput.classList.add('incorrect');
                    siecleInput.classList.remove('correct');
                }
                totalFields++;

                // V√©rifier p√©riode
                const periodeInput = document.getElementById(`periode-${i}`);
                if (checkAnswer(periodeInput.value, d.periode)) {
                    periodeInput.classList.add('correct');
                    periodeInput.classList.remove('incorrect');
                    correctCount++;
                } else {
                    periodeInput.classList.add('incorrect');
                    periodeInput.classList.remove('correct');
                }
                totalFields++;

                // V√©rifier personnage
                const personnageInput = document.getElementById(`personnage-${i}`);
                if (checkAnswer(personnageInput.value, d.personnage)) {
                    personnageInput.classList.add('correct');
                    personnageInput.classList.remove('incorrect');
                    correctCount++;
                } else {
                    personnageInput.classList.add('incorrect');
                    personnageInput.classList.remove('correct');
                }
                totalFields++;
            });

            const percentage = Math.round((correctCount / totalFields) * 100);
            let message = '';
            
            if (percentage === 100) {
                message = `üéâ Parfait ! Tu as tout bon ! Score : ${correctCount}/${totalFields}`;
            } else if (percentage >= 75) {
                message = `üëç Tr√®s bien ! Tu as trouv√© ${correctCount}/${totalFields} r√©ponses correctes.`;
            } else if (percentage >= 50) {
                message = `üí™ Pas mal ! Tu as trouv√© ${correctCount}/${totalFields} r√©ponses. Continue √† t'entra√Æner !`;
            } else {
                message = `üìö Tu as trouv√© ${correctCount}/${totalFields} r√©ponses. R√©vise la m√©thode et recommence !`;
            }

            document.getElementById('resultMessage').textContent = message;
            document.getElementById('result').classList.add('show');
        }

        function showSolution() {
            clearInterval(timerInterval);

            exerciseData.dates.forEach((d, i) => {
                const siecleInput = document.getElementById(`siecle-${i}`);
                const periodeInput = document.getElementById(`periode-${i}`);
                const personnageInput = document.getElementById(`personnage-${i}`);

                // Afficher les bonnes r√©ponses (premi√®re option)
                siecleInput.value = d.siecle[0] || '';
                periodeInput.value = d.periode[0] || '';
                personnageInput.value = d.personnage[0] || '';

                // Marquer comme correct
                siecleInput.classList.add('correct');
                siecleInput.classList.remove('incorrect');
                periodeInput.classList.add('correct');
                periodeInput.classList.remove('incorrect');
                personnageInput.classList.add('correct');
                personnageInput.classList.remove('incorrect');
            });

            document.getElementById('resultMessage').textContent = 'üìñ Voici le corrig√© complet !';
            document.getElementById('result').classList.add('show');
        }

        function restart() {
            exerciseData.dates.forEach((d, i) => {
                const siecleInput = document.getElementById(`siecle-${i}`);
                const periodeInput = document.getElementById(`periode-${i}`);
                const personnageInput = document.getElementById(`personnage-${i}`);

                siecleInput.value = '';
                periodeInput.value = '';
                personnageInput.value = '';

                siecleInput.classList.remove('correct', 'incorrect');
                periodeInput.classList.remove('correct', 'incorrect');
                personnageInput.classList.remove('correct', 'incorrect');
            });

            document.getElementById('result').classList.remove('show');

            clearInterval(timerInterval);
            timeLeft = exerciseData.temps || 600;
            document.getElementById('timer').classList.remove('warning');
            document.getElementById('timer').textContent = `‚è±Ô∏è Temps restant : ${formatTime(timeLeft)}`;
            startTimer();
        }

        // ============================================
        // INITIALISATION
        // ============================================
        async function init() {
            // Charger le sidebar
            await loadSidebar();
            
            // Charger l'exercice
            const params = getUrlParams();
            
            try {
                exerciseData = await loadExerciseData(params.exo);
                renderExercise(exerciseData);
            } catch (error) {
                renderError(`Impossible de charger l'exercice ${params.exo}. V√©rifie que le Google Sheet est bien partag√©.`);
            }
        }

        // Lancer l'initialisation
        init();
    </script>
</body>
</html>
